<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¾†ç¦è¨˜å¸³</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #fffaf0;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        h1, h2, h3 {
            text-align: center;
            color: #ff8c00;
        }
        #container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
        }
        label {
            font-weight: bold;
            display: block;
            margin: 10px 0 5px;
        }
        input, select {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            width: 100%;
            background-color: #ff8c00;
            color: white;
            padding: 10px 20px;
            font-size: 18px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #e07c00;
        }
        #lists {
            margin-top: 20px;
        }
        ul {
            list-style: none;
            padding: 10px;
            background: #ffe4b5;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 15px;
            position: relative;
        }
        ul li {
            margin: 5px 0;
        }
        ul .buttons {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
        }
        .edit-btn, .delete-btn {
            padding: 5px 10px;
            font-size: 14px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .edit-btn {
            background-color: #ffd700;
            color: white;
        }
        .edit-btn:hover {
            background-color: #ffbf00;
        }
        .delete-btn {
            background-color: #d9534f;
            color: white;
        }
        .delete-btn:hover {
            background-color: #c9302c;
        }
        #totalExpense {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: #d9534f;
        }
        .dog-image {
            margin-top: 20px;
            border-radius: 10px;
            width: 100%;
            height: auto;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #888;
        }
        #categoryList {
            margin-top: 20px;
            text-align: left;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="container">
        <h1>ä¾†ç¦è¨˜å¸³ ğŸ¶</h1>
        <img src="https://placedog.net/600/400" alt="å¯æ„›çš„ç‹—ç‹—" class="dog-image">
        
        <!-- é¤é»åç¨± -->
        <label for="meal">æ”¯å‡ºé …ç›®ï¼š</label>
        <input type="text" id="meal" placeholder="è«‹è¼¸å…¥æ”¯å‡ºé …ç›®">
        
        <!-- æ”¯å‡ºé‡‘é¡ -->
        <label for="food">æ”¯å‡ºé‡‘é¡ï¼š</label>
        <input type="number" id="food" placeholder="è«‹è¼¸å…¥æ”¯å‡ºé‡‘é¡">
        
        <!-- æ”¯å‡ºåˆ†é¡ -->
        <label for="category">æ”¯å‡ºåˆ†é¡ï¼š</label>
        <select id="category">
        </select>

        <button id="addCategory">æ–°å¢åˆ†é¡</button>

        <label for="newCategory">æ–°å¢åˆ†é¡åç¨±ï¼š</label>
        <input type="text" id="newCategory" placeholder="è«‹è¼¸å…¥æ–°åˆ†é¡åç¨±">
        
        <!-- æ—¥æœŸ -->
        <label for="date">æ—¥æœŸï¼š</label>
        <input type="date" id="date">

        <button id="bt">æ–°å¢æ”¯å‡º</button>

        <h2>æ”¯å‡ºæ¸…å–®</h2>
        <div id="lists"></div>
        
        <h3>å…¨éƒ¨æ”¯å‡º</h3>
        <p id="totalExpense">$0.00</p>

        <h3>æ”¯å‡ºæ¯”ä¾‹</h3>
        <canvas id="expenseChart" width="400" height="400"></canvas>

        <div id="categoryList">
            <h3>ç›®å‰çš„åˆ†é¡</h3>
            <ul id="categoryItems"></ul>
        </div>
    </div>

    <footer>
        ç”±ä¾†ç¦é™ªä¼´æ‚¨çš„è¨˜å¸³ä¹‹æ—… ğŸ¾
    </footer>

    <script>
        const mealInput = document.getElementById("meal");
        const foodInput = document.getElementById("food");
        const categoryInput = document.getElementById("category");
        const dateInput = document.getElementById("date");
        const newCategoryInput = document.getElementById("newCategory");
        const lists = document.getElementById("lists");
        const totalExpense = document.getElementById("totalExpense");
        const bt = document.getElementById("bt");
        const addCategoryBtn = document.getElementById("addCategory");
        const categoryItemsList = document.getElementById("categoryItems");
        const ctx = document.getElementById("expenseChart").getContext("2d");

        let totalExpenses = 0; // ç´€éŒ„æ‰€æœ‰æ”¯å‡ºçš„ç¸½é‡‘é¡
        const categoryTotals = {}; // ç”¨ä¾†å‹•æ…‹ç®¡ç†æ‰€æœ‰æ”¯å‡ºåˆ†é¡

        let chart = new Chart(ctx, {
            type: "pie",
            data: {
                labels: [],
                datasets: [{
                    label: "æ”¯å‡ºæ¯”ä¾‹",
                    data: [],
                    backgroundColor: ["#FF6384", "#36A2EB", "#FFCE56", "#AAFF56"]
                }]
            },
            options: {
                responsive: true
            }
        });

        // åˆå§‹åŒ–åˆ†é¡
        function initializeCategories() {
            categoryInput.innerHTML = "";
            Object.keys(categoryTotals).forEach(category => {
                let option = document.createElement("option");
                option.value = category;
                option.textContent = category;
                categoryInput.appendChild(option);
            });
            updateCategoryList();
        }

        // æ›´æ–°åˆ†é¡åˆ—è¡¨
        function updateCategoryList() {
            categoryItemsList.innerHTML = "";
            Object.keys(categoryTotals).forEach(category => {
                const listItem = document.createElement("li");
                listItem.textContent = category;
                
                // åŠ å…¥åˆªé™¤æŒ‰éˆ•
                const deleteBtn = document.createElement("button");
                deleteBtn.textContent = "åˆªé™¤";
                deleteBtn.addEventListener("click", () => deleteCategory(category));
                listItem.appendChild(deleteBtn);
                categoryItemsList.appendChild(listItem);
            });
        }

        // åˆªé™¤åˆ†é¡
        function deleteCategory(category) {
            if (categoryTotals[category]) {
                delete categoryTotals[category];
                initializeCategories();
                updateChart();
            }
        }

        // æ–°å¢æ”¯å‡º
        bt.addEventListener("click", function () {
            const meal = mealInput.value.trim();
            const food = parseFloat(foodInput.value);
            const category = categoryInput.value;
            const date = dateInput.value;

            if (meal === "") {
                alert("è«‹è¼¸å…¥æ”¯å‡ºé …ç›®ï¼");
                return;
            }
            if (isNaN(food)) {
                alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„é‡‘é¡ï¼");
                return;
            }
            if (date === "") {
                alert("è«‹é¸æ“‡æ—¥æœŸï¼");
                return;
            }

            totalExpenses += food;
            if (!categoryTotals[category]) {
                categoryTotals[category] = 0;
            }
            categoryTotals[category] += food;

            const listItem = document.createElement("ul");
            listItem.innerHTML = `
                <li>é …ç›®åç¨±ï¼š${meal}</li>
                <li>é‡‘é¡ï¼š$${food.toFixed(2)}</li>
                <li>åˆ†é¡ï¼š${category}</li>
                <li>æ—¥æœŸï¼š${date}</li>
                <div class="buttons">
                    <button class="edit-btn">ç·¨è¼¯</button>
                    <button class="delete-btn">åˆªé™¤</button>
                </div>
            `;

            listItem.querySelector(".edit-btn").addEventListener("click", () => {
                mealInput.value = meal;
                foodInput.value = food;
                categoryInput.value = category;
                dateInput.value = date;

                totalExpenses -= food;
                categoryTotals[category] -= food;
                updateChart();
                updateTotal();
                listItem.remove();
            });

            listItem.querySelector(".delete-btn").addEventListener("click", () => {
                totalExpenses -= food;
                categoryTotals[category] -= food;
                updateChart();
                updateTotal();
                listItem.remove();
            });

            lists.appendChild(listItem);
            updateTotal();
            updateChart();
            mealInput.value = "";
            foodInput.value = "";
            dateInput.value = "";
        });

        // æ–°å¢åˆ†é¡
        addCategoryBtn.addEventListener("click", function () {
            const newCategory = newCategoryInput.value.trim();
            if (newCategory && !categoryTotals[newCategory]) {
                categoryTotals[newCategory] = 0;
                initializeCategories();
                newCategoryInput.value = "";
            }
        });

        function updateTotal() {
            totalExpense.textContent = `$${totalExpenses.toFixed(2)}`;
        }

        function updateChart() {
            chart.data.labels = Object.keys(categoryTotals);
            chart.data.datasets[0].data = Object.values(categoryTotals);
            chart.update();
        }

        // åˆå§‹åŒ–åˆ†é¡
        initializeCategories();
    </script>
</body>
</html>
